## Janus Project: Export File JSON Specification

This document defines the structure of the JSON file generated by the `janus export` command. The purpose of this format is to create a single, self-contained, and portable artifact that represents a complete experiment, including all its components and results.

### Top-Level Object

The root of the JSON file is an object with the following properties:

| Key                    | Type   | Description                                                                                             |
| ---------------------- | ------ | ------------------------------------------------------------------------------------------------------- |
| `janus_export_version` | string | The version of the export format schema. This allows for backward compatibility as the format evolves.    |
| `exported_at`          | string | An ISO 8601 timestamp indicating when the file was generated.                                           |
| `data`                 | object | The main container for all the exported entities and their relationships, representing a graph snapshot. |

---

### The `data` Object

The `data` object contains two primary keys: `nodes` and `relationships`.

#### `data.nodes`

An object containing arrays of all the exported entities, grouped by their type.

*   **`snippets`**: `array` of Snippet objects.
*   **`snippet_versions`**: `array` of SnippetVersion objects.
*   **`parameters`**: `array` of Parameter objects.
*   **`parameter_options`**: `array` of ParameterOption objects.
*   **`compositions`**: `array` of Composition objects.
*   **`composition_versions`**: `array` of CompositionVersion objects.
*   **`test_runs`**: `array` of TestRun objects.
*   **`data_points`**: `array` of DataPoint objects.
*   **`tags`**: `array` of Tag objects.

Each object within these arrays conforms to the structure defined in the `DOMAIN_MODEL.md` specification.

#### `data.relationships`

An array of objects, where each object defines a single relationship between two nodes in the snapshot. This is the "glue" that reconstructs the graph structure.

Each relationship object has the following structure:

| Key          | Type   | Description                                                                                                                            |
| ------------ | ------ | -------------------------------------------------------------------------------------------------------------------------------------- |
| `from`       | string | The UUID of the starting node for the relationship.                                                                                    |
| `to`         | string | The UUID of the ending node for the relationship.                                                                                      |
| `type`       | string | The type of the relationship. See the list of valid types below.                                                                       |
| `properties` | object | (Optional) A key-value map of any properties stored on the relationship itself (e.g., `role` and `sequence` for the `INCLUDES` type). |

**Valid Relationship `type` values:**
`VERSION_OF`, `PREVIOUS_VERSION`, `DEFINES_PARAMETER`, `HAS_OPTION`, `DERIVED_FROM`, `INCLUDES`, `GENERATED`, `USING_COMPOSITION`, `HAS_TAG`.

---

### Example Export File

Here is a concrete example of an exported JSON file representing a small experiment.

```json
{
  "janus_export_version": "1.0",
  "exported_at": "2025-07-03T12:00:00Z",
  "data": {
    "nodes": {
      "snippets": [
        {
          "id": "snippet-uuid-01",
          "name": "formal-greeting-persona",
          "description": "A formal, professional persona for starting a prompt."
        }
      ],
      "snippet_versions": [
        {
          "id": "snippet-version-uuid-01a",
          "content": "You are a professional assistant. Your tone should be formal and respectful. The user's name is {{user_name}}.",
          "createdAt": "2025-07-02T10:00:00Z",
          "commit_message": "Initial version of formal persona."
        }
      ],
      "parameters": [
        {
          "id": "param-uuid-01",
          "name": "user_name",
          "description": "The name of the user to address."
        }
      ],
      "parameter_options": [],
      "compositions": [
        {
          "id": "comp-uuid-01",
          "name": "formal-greeting-test",
          "description": "A simple test for the formal greeting."
        }
      ],
      "composition_versions": [
        {
          "id": "comp-version-uuid-01a",
          "createdAt": "2025-07-02T11:00:00Z",
          "commit_message": "First composition for testing the formal greeting."
        }
      ],
      "test_runs": [
        {
          "id": "test-run-uuid-01",
          "name": "Initial Formal Greeting Test",
          "createdAt": "2025-07-03T11:30:00Z",
          "llm_provider": "openai",
          "llm_model": "gpt-4o-2024-05-13",
          "metadata": { "team": "red-team", "sprint": "sprint-5" }
        }
      ],
      "data_points": [
        {
          "id": "datapoint-uuid-01",
          "final_prompt_text": "You are a professional assistant. Your tone should be formal and respectful. The user's name is Alice.",
          "response_text": "Hello, Alice. How may I assist you today?",
          "metrics": { "latency_ms": 850, "completion_tokens": 12 }
        }
      ],
      "tags": []
    },
    "relationships": [
      {
        "from": "snippet-version-uuid-01a",
        "to": "snippet-uuid-01",
        "type": "VERSION_OF"
      },
      {
        "from": "snippet-version-uuid-01a",
        "to": "param-uuid-01",
        "type": "DEFINES_PARAMETER"
      },
      {
        "from": "comp-version-uuid-01a",
        "to": "comp-uuid-01",
        "type": "VERSION_OF"
      },
      {
        "from": "comp-version-uuid-01a",
        "to": "snippet-version-uuid-01a",
        "type": "INCLUDES",
        "properties": { "role": "system", "sequence": 1 }
      },
      {
        "from": "test-run-uuid-01",
        "to": "datapoint-uuid-01",
        "type": "GENERATED"
      },
      {
        "from": "datapoint-uuid-01",
        "to": "comp-version-uuid-01a",
        "type": "USING_COMPOSITION"
      }
    ]
  }
}
```